‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, select_related ‡¶†‡¶ø‡¶ï‡¶á join query ‡¶ï‡¶∞‡ßá‡•§ üòé

‡¶∏‡ßç‡¶™‡¶∑‡ßç‡¶ü‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡¶≤‡¶≤‡ßá:

select_related ForeignKey ‡¶¨‡¶æ OneToOneField ‡¶•‡¶æ‡¶ï‡¶æ related object-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø SQL JOIN ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡•§

‡¶è‡¶§‡ßá ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ query ‡¶®‡¶æ ‡¶¶‡¶ø‡ßü‡ßá single query ‡¶§‡ßá ‡¶∏‡¶¨ data fetch ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡•§

‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé, ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ø‡¶ñ‡¶® book.author.name access ‡¶ï‡¶∞‡¶¨‡ßá, extra query ‡¶ö‡¶≤‡ßá ‡¶®‡¶æ‡•§

‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£:

books = Book.objects.select_related('author').all()


‡¶è‡¶∞ SQL ‡¶π‡¶¨‡ßá:

SELECT book.id, book.title, book.author_id, author.id, author.name
FROM book
INNER JOIN author ON book.author_id = author.id;


‡¶è‡¶ï‡¶ü‡¶æ‡¶á query, join ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶¨ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶ø‡ßü‡ßá ‡¶Ü‡¶∏‡ßá‡•§

‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø: select_related ManyToManyField ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ, ‡¶∏‡ßá‡¶ü‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá prefetch_related ‡¶¶‡¶ø‡ßü‡ßá‡•§

1Ô∏è‚É£ Normal ForeignKey
class Author(models.Model):
    name = models.CharField(max_length=100)

class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)


‡¶è‡¶ñ‡¶æ‡¶®‡ßá Book ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá author field ‡¶Ü‡¶õ‡ßá‡•§

‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé Book ‚Üí Author (Book ‡¶ú‡¶æ‡¶®‡ßá ‡¶§‡¶æ‡¶∞ Author ‡¶ï‡ßá)

‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶π‡¶ú‡ßá access ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø:

book = Book.objects.first()
print(book.author.name)  # book ‡¶•‡ßá‡¶ï‡ßá author


‡¶è‡¶á‡¶ü‡¶æ forward relation‡•§

2Ô∏è‚É£ Reverse ForeignKey

‡¶è‡¶ñ‡¶® Author ‡¶ú‡¶æ‡¶®‡ßá ‡¶ï‡ßá ‡¶ï‡ßá ‡¶§‡¶æ‡¶∞ ‡¶¨‡¶á ‡¶≤‡¶ø‡¶ñ‡ßá‡¶õ‡ßá?

Django automatically ‡¶¶‡ßá‡ßü reverse relation: book_set

author = Author.objects.first()
books = author.book_set.all()  # reverse relation
for book in books:
    print(book.title)


‡¶è‡¶ñ‡¶æ‡¶®‡ßá Author ‚Üí multiple Books

‡¶è‡¶á‡¶ü‡¶æ ‡¶π‡¶≤‡ßã reverse ForeignKey

‡¶Æ‡ßÇ‡¶≤ ForeignKey Book ‚Üí Author, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ Author ‡¶•‡ßá‡¶ï‡ßá access ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã reverse relation ‡¶¶‡¶ø‡ßü‡ßá‡•§

3Ô∏è‚É£ Custom related_name
class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.ForeignKey(Author, on_delete=models.CASCADE, related_name='books')


‡¶è‡¶¨‡¶æ‡¶∞:

author = Author.objects.first()
author.books.all()  # book_set ‡¶è‡¶∞ ‡¶¨‡¶¶‡¶≤‡ßá ‡¶è‡¶ñ‡¶® books


‡¶Ü‡¶∞‡¶ì readable name!

4Ô∏è‚É£ Key Concept
Direction	Example	Access
Forward FK	Book ‚Üí Author	book.author
Reverse FK	Author ‚Üí Books	author.book_set.all() ‡¶¨‡¶æ custom name author.books.all()

Forward FK = single object

Reverse FK = multiple objects (QuerySet)

üí° ‡¶Æ‡ßÇ‡¶≤ ‡¶ï‡¶•‡¶æ:
Reverse ForeignKey ‡¶Æ‡¶æ‡¶®‡ßá ‡¶π‡¶≤‡ßã ‚ÄúForeignKey field ‡¶è‡¶∞ ‡¶â‡¶≤‡ßç‡¶ü‡ßã ‡¶¶‡¶ø‡¶ï‡ßá access ‡¶ï‡¶∞‡¶æ‚Äù, ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ multiple objects ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§