{% extends 'base.html' %}
{% load static %}
{% block title %}Product details{% endblock title %}

{% block main_content %}
<!-- breadcrumb__area-start -->
<section class="breadcrumb__area box-plr-75">
    <div class="container">
        <div class="row">
            <div class="col-xxl-12">
                <div class="breadcrumb__wrapper">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Shop</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- breadcrumb__area-end -->

<!-- product-details-start -->
<div class="product-details">
    <div class="container">
        <div class="row">
            <!-- Product Images -->
            <div class="col-xl-6">
                <div class="product__details-nav d-sm-flex align-items-start">
                    {% if product.images.exists %}
                    <ul class="nav nav-tabs flex-sm-column justify-content-between" id="productThumbTab" role="tablist">
                        {% for img in product.images.all %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link {% if forloop.first %}active{% endif %}" id="thumb{{ img.id }}-tab" data-bs-toggle="tab" data-bs-target="#thumb{{ img.id }}" type="button" role="tab" aria-controls="thumb{{ img.id }}" aria-selected="{% if forloop.first %}true{% else %}false{% endif %}">
                                <img src="{{ img.image.url }}" alt="{{ product.title|title }}" class="img-fluid" style="width:100px; height:150px; object-fit:cover;">
                            </button>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}


                    <div class="product__details-thumb">
                        <div class="tab-content" id="productThumbContent">
                            {% if product.images.exists %}
                            {% for img in product.images.all %}
                            <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" 
                                id="thumb{{ img.id }}" 
                                role="tabpanel" 
                                aria-labelledby="thumb{{ img.id }}-tab">
                                <div class="product__details-nav-thumb w-img">
                                    <img src="{{ img.image.url }}" alt="{{ product.title|title }}" style="width: 350px; height: 500px; object-fit:cover;">
                                </div>
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                    </div>

                </div>
            </div>

            <!-- Product Details Content -->
            <div class="col-xl-6">
                <div class="product__details-content">
                    <h6>{{product.title|title}}</h6>

                    <!-- Rating -->
                    <div class="pd-rating mb-10">
                        <ul class="rating">
                            <i class="fa {% if product.avg_rate >= 1 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                            <i class="fa {% if product.avg_rate >= 2 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                            <i class="fa {% if product.avg_rate >= 3 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                            <i class="fa {% if product.avg_rate >= 4 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                            <i class="fa {% if product.avg_rate >= 5 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                        </ul>
                        <span>({{ product.reviews.count }} review{{ product.reviews.count|pluralize }})</span>
                    </div>

                    <!-- Price -->
                    <div class="price mb-10">
                        <span>
                        $ <span id="product-price">{{product.sale_price}}</span>
                        <del class="text-danger">
                                {% if product.old_price %}
                                $ {{product.old_price}}
                                {% endif %}
                        </del>
                        </span>
                    </div>

                    <!-- Features -->
                    <div class="features-des mb-20 mt-10">
                        <ul>
                            <li><span><i class="fas fa-circle"></i> Discount: {{product.discount_percent}} %.</span></li>
                            <li><span><i class="fas fa-circle"></i> Category: {{product.category.title|title}}.</span></li>
                            <li><span><i class="fas fa-circle"></i> Brand: {{product.brand.title|title}}.</span></li>
                        </ul>
                    </div>

                    <!-- Stock -->
                    <div class="product-stock mb-20">
                        <h5>Availability: <span>{{product.available_stock}}</span></h5>
                    </div>

                    <!-- Color Options -->
                    <div class="details-meta colors">
                        {% if product.variants.exists %}
                        <div class="nav nav-tabs d-flex flex-row gap-2 mb-2" id="productThumbTab" role="tablist">
                            <label>Colors:</label>

                            {% for variant in product.variants.all %}
                            {% if variant.color %}
                            <button class="nav-link color-btn p-0 border-0 {% if forloop.first %}active{% endif %}"
                                id="color{{ variant.id }}-tab"
                                data-color-id="{{ variant.color.id }}"
                                type="button">

                                <img src="{{ variant.image.url }}"
                                    alt="{{ variant.product.title }}"
                                    class="img-fluid rounded"
                                    style="width:45px; height:45px; object-fit:cover;">
                            </button>
                            {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}


                        <a href="#" class="size-guide d-inline-flex align-items-center" style="font-size:14px;">
                            <i class="fal fa-list me-1"></i> If you select colors extra price
                        </a>
                    </div>

                    <!-- Size Options -->
                    <div class="details-meta sizes">
                        {% if product.variants.exists %}
                        <label>Sizes:</label>
                        <div class="size">
                            {% for variant in product.variants.all %}
                            {% if variant.size %}
                            <label class="custom-control custom-radio custom-control-inline">
                                <input type="radio"
                                    name="select_size"
                                    value="{{ variant.size.id }}"
                                    class="custom-control-input">

                                <span class="custom-control-label">
                                    {{ variant.size.title }}
                                </span>
                            </label>
                            {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                        <a href="#" class="size-guide"><i class="fal fa-list"></i> If you select sizes extra price</a>
                    </div>

                    <!-- Cart & Wishlist -->
                    <div class="cart-option mb-15">
                        <div class="product-quantity mr-20">
                            <div class="cart-plus-minus p-relative">
                                <input type="text" value="1">
                                <div class="dec qtybutton">-</div>
                                <div class="inc qtybutton">+</div>
                            </div>
                        </div>
                        <a href="cart.html" class="cart-btn">Add to Cart</a>
                    </div>

                    <div class="details-meta">
                        <div class="d-meta-left">
                            <div class="dm-item mr-20">
                                <a href="#"><i class="fal fa-heart"></i> Add to wishlist</a>
                            </div>
                            <div class="dm-item">
                                <a href="#"><i class="fal fa-layer-group"></i> Compare</a>
                            </div>
                        </div>
                        <div class="d-meta-left">
                            <div class="dm-item">
                                <a href="#"><i class="fal fa-share-alt"></i> Share</a>
                            </div>
                        </div>
                    </div>

                    <!-- Tags & SKU -->
                    <div class="product-tag-area mt-15">
                        <div class="product_info">
                            <span class="sku_wrapper">
                                <span class="title">SKU:</span>
                            {% if variant %}
                                <span class="sku">
                                    {% if variant.color %}{{ variant.color.title }}{% endif %}
                                    {% if variant.color and variant.size %} - {% endif %}
                                    {% if variant.size %}{{ variant.size.title }}{% endif %}
                                </span>
                            {% endif %}

                            </span>


                            <span class="tagged_as">
                                <span class="title">Tags:</span>
                                <a href="#">{{product.tag}}</a>
                            </span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- product-details-end -->

<!-- product-details-des-start -->
<div class="product-details-des mt-40 mb-60">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="product__details-des-tab">
                    <ul class="nav nav-tabs" id="productDesTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="des-tab" data-bs-toggle="tab" data-bs-target="#des" type="button" role="tab" aria-controls="des" aria-selected="true">Description</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="aditional-tab" data-bs-toggle="tab" data-bs-target="#aditional" type="button" role="tab" aria-controls="aditional" aria-selected="false">Additional information</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="review-tab" data-bs-toggle="tab" data-bs-target="#review" type="button" role="tab" aria-controls="review" aria-selected="false">Reviews (1)</button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="tab-content" id="prodductDesTaContent">
            <div class="tab-pane fade active show" id="des" role="tabpanel" aria-labelledby="des-tab">
                <div class="product__details-des-wrapper">
                    <h6 class="des-sm-title">{{product.prev_des}}</h6>
                    <p class="des-text mb-35">
                        {{product.add_des}}
                    </p>
                </div>
                <div class="product__details-des-wrapper">
                    <h6 class="des-sm-title">{{product.short_des}}</h6>
                    <p class="des-text mb-35">
                        {{product.long_des}}
                    </p>
                </div>
            </div>

            <div class="tab-pane fade" id="aditional" role="tabpanel" aria-labelledby="aditional-tab">
                <div class="product__desc-info">
                    <ul>
                        <li><h6>Weight</h6><span>2 lbs</span></li>
                        <li><h6>Dimensions</h6><span>12 × 16 × 19 in</span></li>
                        <li><h6>Product</h6><span>Purchase this product on rag-bone.com</span></li>
                        <li><h6>Color</h6><span>Gray, Black</span></li>
                        <li><h6>Size</h6><span>S, M, L, XL</span></li>
                        <li><h6>Model</h6><span>Model</span></li>
                        <li><h6>Shipping</h6><span>Standard shipping: $5,95</span></li>
                        <li><h6>Care Info</h6><span>Machine Wash up to 40ºC/86ºF Gentle Cycle</span></li>
                        <li><h6>Brand</h6><span>Kazen</span></li>
                    </ul>
                </div>
            </div>

            <div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
                <div class="product__details-review">
                    <div class="row">
                        <div class="col-xl-4">
                            <div class="review-des-infod">
                                <h6>1 review for "<span>Wireless Bluetooth Over-Ear Headphones</span>"</h6>
                                <div class="review-details-des">
                                    <div class="author-image mr-15">
                                        <a href="#"><img src="{% static "assets/img/author/author-sm-1.jpg" %}" alt=""></a>
                                    </div>
                                    <div class="review-details-content">
                                        <h5>5.00</h5>
                                        <div class="str-info">
                                            <div class="review-star mr-15">
                                                <i class="fa {% if product.avg_rate >= 1 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                                <i class="fa {% if product.avg_rate >= 2 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                                <i class="fa {% if product.avg_rate >= 3 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                                <i class="fa {% if product.avg_rate >= 4 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                                <i class="fa {% if product.avg_rate >= 5 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                            </div>
                                        </div>
                                        <div class="name-date mb-30">
                                            <h6> admin – <span> May 27, 2021</span></h6>
                                        </div>
                                        <p>
                                            A light chair, easy to move around the dining table and about the room. Duis aute irure dolor in reprehenderit in <br> voluptate velit esse cillum dolore eu fugiat nulla pariatur.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-8">
                            <div class="product__details-comment">
                                <div class="comment-title mb-20">
                                    <h3>Add a review</h3>
                                    <p>Your email address will not be published. Required fields are marked *</p>
                                </div>
                                <div class="comment-rating mb-20">
                                    <ul class="rating_submit">
                                        <span><i class="star fa-solid fa-star"></i></span>
                                        <span><i class="star fa-solid fa-star"></i></span>
                                        <span><i class="star fa-solid fa-star"></i></span>
                                        <span><i class="star fa-solid fa-star"></i></span>
                                        <span><i class="star fa-solid fa-star"></i></span>
                                    </ul>
                                </div>

                                <div class="comment-input-box">
                                    <form action="#">
                                        <div class="row g-3">
                                            <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 comment-input">
                                                <input type="text" id="comment-name" class="form-control" placeholder="Your Name">
                                            </div>

                                            <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 comment-input">
                                                <input type="email" id="comment-email" class="form-control" placeholder="Your Email">
                                            </div>

                                            <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 comment-input">
                                                <textarea id="comment-message" class="form-control" rows="5" placeholder="Your Review"></textarea>
                                            </div>
                                            <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 comment-submit">
                                                <button type="submit" class="cart-btn form-control">Submit</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- product-details-des-end -->

<!-- relative product start -->
<section class="relative-product pb-60">
    <div class="container">
        <div class="row">
            <div class="col-xxl-12">
                <div class="section__title-wrapper text-center mb-40">
                    <h2 class="section__title">Related Products</h2>
                </div>
            </div>
        </div>
       <div class="row">
            <div class="product-bs-slider">
                <div class="product-slider swiper-container">
                    <div class="swiper-wrapper">
                    {% if related_products %}
                    {% for product in related_products %}
                        <!-- product-1 -->
                        <div class="product__item swiper-slide">
                            <div class="product__thumb fix">
                                <div class="product-image w-img">
                                    <a href="{% url 'product-detail' product.id %}">
                                        <img src="{{product.images.first.image.url}}" alt="{{product.title|title}}" style="width: 260px; height: 300px; object-fit: cover">
                                    </a>
                                </div>
                                {% if product.deadline %}
                                <div class="countdown countdown-small mt-5">
                                    <div class="countdown-inner b-radius"
                                        data-countdown=""
                                        data-date="{{ product.deadline|date:'c' }}">
                                        <ul class="text-center" style="padding:0; list-style:none; display:flex; justify-content:center; gap:10px;">
                                            <li><span data-days="">0</span>d</li>
                                            <li><span data-hours="">0</span>h</li>
                                            <li><span data-minutes="">0</span>m</li>
                                            <li><span data-seconds="">0</span>s</li>
                                        </ul>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="product__offer">
                                    <span class="discount">-{{product.discount_percent}}%</span>
                                </div>
                                <div class="product-action">
                                    <a href="#" class="icon-box icon-box-1" data-bs-toggle="modal" data-bs-target="#productModalId">
                                        <i class="fal fa-eye"></i>
                                        <i class="fal fa-eye"></i>
                                    </a>
                                    <a href="#" class="icon-box icon-box-1">
                                        <i class="fal fa-heart"></i>
                                        <i class="fal fa-heart"></i>
                                    </a>
                                    <a href="#" class="icon-box icon-box-1">
                                        <i class="fal fa-layer-group"></i>
                                        <i class="fal fa-layer-group"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="product__content">
                                <h6><a href="{% url 'product-detail' product.id %}">{{product.title|title|truncatewords:5}}</a></h6>
                                <div class="rating mb-5">
                                    <ul>
                                        <i class="fa {% if product.avg_rate >= 1 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                        <i class="fa {% if product.avg_rate >= 2 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                        <i class="fa {% if product.avg_rate >= 3 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                        <i class="fa {% if product.avg_rate >= 4 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                        <i class="fa {% if product.avg_rate >= 5 %}fa-star{% else %}fa-star-o{% endif %}" style="color: #FFD700;"></i>
                                    </ul>
                                    <span>({{ product.reviews.count }} review{{ product.reviews.count|pluralize }})</span>
                                </div>
                                <div class="price mb-10"><span>
                                   $ {{product.sale_price}}
                                    <del class="text-danger">
                                    {% if product.old_price %}
                                       $ {{product.old_price}}
                                    {% endif %}
                                    </del>
                                </span></div>
                                <div class="progress mb-5">
                                    <div class="progress-bar bg-danger" style="width:10%"></div>
                                </div>
                                <div class="progress-rate"><span>Sold {{product.sold}}</span></div>
                            </div>
                            <div class="product__add-cart text-center">
                                <button class="cart-btn w-100">Add to Cart</button>
                            </div>
                        </div>
                    {% endfor %}
                    {% else %}
                    <p>No products found </p>
                    {% endif %}
                    </div>
                </div>

                <div class="bs-button bs-button-prev"><i class="fal fa-chevron-left"></i></div>
                <div class="bs-button bs-button-next"><i class="fal fa-chevron-right"></i></div>
            </div>
        </div>
    </div>
</section>
<!-- relative product end -->

<!-- shop modal start -->
{% include 'store/product-modals.html' %}
<!-- shop modal end -->

<script>
document.addEventListener("DOMContentLoaded", function () {

    const buttons = document.querySelectorAll(".color-btn");
    const priceBox = document.getElementById("product-price");

    buttons.forEach(btn => {
        btn.addEventListener("click", function () {

            const colorID = this.dataset.colorId;

            // Active button update
            buttons.forEach(b => b.classList.remove("active"));
            this.classList.add("active");

            // AJAX Request
            fetch("{% url 'get-variants' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({
                    "color_id": colorID,
                    "product_id": "{{ product.id }}"
                })
            })
            .then(res => res.json())
            .then(data => {
                priceBox.innerText = data.new_price;
            });

        });
    });

});
</script>

{% endblock main_content %}
